<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>פתיחת קריאה</title>

<style>
body { font-family: Arial; background:#f2f2f2; display:flex; justify-content:center; align-items:center; height:100vh; }
.card { background:white; padding:25px; width:350px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
input, textarea { width:100%; margin-bottom:10px; padding:10px; }
button { width:100%; padding:12px; background:#ff6600; color:white; border:none; cursor:pointer; }
</style>
</head>
<body>

<div class="card">
<h3>פתיחת קריאה</h3>
<input type="text" id="name" placeholder="שם מלא">
<input type="tel" id="phone" placeholder="טלפון">
<input type="text" id="branch" placeholder="סניף">
<textarea id="desc" placeholder="תיאור התקלה"></textarea>
<button onclick="sendTicket()">שלח קריאה</button>
<div id="status"></div>
</div>

<script>
var BASE_URL="https://chat.bar-t.co.il";

(function(d,t) {
  var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=BASE_URL+"/packs/js/sdk.js";
  g.async=true;
  s.parentNode.insertBefore(g,s);
  g.onload=function(){
    window.chatwootSDK.run({
      websiteToken: 'h9DWhNDA2QJUmnMgyCVnDtRZ',
      baseUrl: BASE_URL
    });
  }
})(document,"script");


async function waitForChatwoot() {
  return new Promise(resolve => {
    const interval = setInterval(() => {
      if (window.$chatwoot) {
        clearInterval(interval);
        resolve();
      }
    }, 200);
  });
}

async function sendTicket() {

  document.getElementById("status").innerText = "שולח...";

  await waitForChatwoot();

  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const branch = document.getElementById("branch").value;
  const desc = document.getElementById("desc").value;

  try {

    window.$chatwoot.setUser(phone, {
      name: name,
      phone_number: phone,
      branch: branch
    });

    // פתיחת שיחה
    window.$chatwoot.toggle("open");

    setTimeout(() => {

      window.$chatwoot.sendMessage(
        "קריאה חדשה:\n\n" +
        "שם: " + name + "\n" +
        "טלפון: " + phone + "\n" +
        "סניף: " + branch + "\n\n" +
        "תיאור:\n" + desc
      );

      document.getElementById("status").innerText = "נשלח בהצלחה!";

    }, 1200);

  } catch (e) {
    document.getElementById("status").innerText = "שגיאה בשליחה";
    console.error(e);
  }
}
</script>

</body>
</html>
